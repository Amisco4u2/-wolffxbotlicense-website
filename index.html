<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wolf FX Trading Academy - Professional Expert Advisor</title>
    
    <!-- CSS styles from previous file - keeping it concise for character limit -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #0a0e27 0%, #1a1e37 100%); color: white; line-height: 1.6; min-height: 100vh; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        
        header { background: rgba(10, 14, 39, 0.95); padding: 20px 0; border-bottom: 3px solid #00ff88; margin-bottom: 30px; box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3); }
        h1 { text-align: center; color: #00ff88; font-size: 2.5rem; margin-bottom: 15px; text-shadow: 0 0 20px rgba(0, 255, 136, 0.5); }
        .subtitle { text-align: center; color: #8892a8; font-size: 1.2rem; margin-bottom: 20px; }
        .nav { display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; }
        .nav-btn { background: rgba(0, 255, 136, 0.1); color: #00ff88; border: 2px solid #00ff88; padding: 12px 30px; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s; }
        .nav-btn:hover { background: rgba(0, 255, 136, 0.2); transform: translateY(-2px); }
        
        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .section { background: rgba(26, 30, 55, 0.9); padding: 40px; border-radius: 15px; border: 2px solid #00ff88; margin-bottom: 30px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); }
        .section h2 { color: #00ff88; margin-bottom: 25px; font-size: 2rem; }
        .section h3 { color: #00ff88; margin: 25px 0 15px; font-size: 1.5rem; }
        
        .hero { background: linear-gradient(135deg, rgba(0, 255, 136, 0.1), rgba(0, 204, 106, 0.05)); border: 3px solid #00ff88; padding: 50px; text-align: center; border-radius: 20px; margin-bottom: 40px; }
        
        .pricing-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; margin-top: 30px; }
        .pricing-card { background: linear-gradient(135deg, #1a1e37, #0a0e27); border: 3px solid #444; border-radius: 15px; padding: 35px; text-align: center; transition: all 0.3s; }
        .pricing-card:hover { border-color: #00ff88; transform: translateY(-10px); box-shadow: 0 15px 50px rgba(0, 255, 136, 0.4); }
        .plan-name { font-size: 1.8rem; font-weight: bold; color: #00ff88; margin-bottom: 15px; }
        .plan-price { font-size: 3rem; font-weight: bold; margin-bottom: 10px; background: linear-gradient(135deg, #00ff88, #00cc6a); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        .btn { background: linear-gradient(135deg, #00ff88, #00cc6a); color: #0a0e27; border: none; padding: 15px 40px; font-size: 1.2rem; font-weight: bold; border-radius: 10px; cursor: pointer; width: 100%; margin-top: 20px; transition: all 0.3s; }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0, 255, 136, 0.5); }
        .btn-small { padding: 8px 20px; font-size: 0.9rem; margin: 5px; width: auto; }
        .btn-danger { background: linear-gradient(135deg, #ff3366, #cc0044); }
        .btn-secondary { background: transparent; border: 2px solid #00ff88; color: #00ff88; }
        
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; color: #00ff88; font-weight: bold; margin-bottom: 8px; }
        .form-group input, .form-group select { width: 100%; padding: 14px; font-size: 1rem; background: #0a0e27; border: 2px solid #444; border-radius: 8px; color: white; }
        .form-group input:focus { outline: none; border-color: #00ff88; }
        
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.95); z-index: 1000; overflow-y: auto; }
        .modal.active { display: block; }
        .modal-content { background: linear-gradient(135deg, #1a1e37, #0a0e27); max-width: 1000px; margin: 50px auto; border-radius: 20px; border: 3px solid #00ff88; padding: 40px; position: relative; }
        .close-btn { position: absolute; top: 20px; right: 20px; font-size: 2.5rem; color: #00ff88; cursor: pointer; background: none; border: none; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #444; }
        th { background: linear-gradient(135deg, #00ff88, #00cc6a); color: #0a0e27; font-weight: bold; }
        
        .badge { padding: 6px 18px; border-radius: 20px; font-size: 0.85rem; font-weight: bold; display: inline-block; }
        .badge-pending { background: #ffa500; color: white; }
        .badge-active { background: #00ff88; color: #0a0e27; }
        .badge-expired { background: #ff3366; color: white; }
        
        .alert { padding: 20px; border-radius: 10px; margin: 20px 0; border-left: 5px solid; }
        .alert-info { background: rgba(0, 136, 255, 0.1); border-color: #0088ff; color: #88ccff; }
        .alert-success { background: rgba(0, 255, 136, 0.1); border-color: #00ff88; color: #88ffcc; }
        
        .text-link { color: #00ff88; text-decoration: underline; cursor: pointer; }
        .hidden { display: none !important; }
        
        @media (max-width: 768px) {
            h1 { font-size: 2rem; }
            .pricing-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>üê∫ Wolf FX Trading Academy</h1>
            <p class="subtitle">Advanced Automated Trading Solutions</p>
            <div class="nav">
                <button class="nav-btn" onclick="showPage('home')">üè† Home</button>
                <button class="nav-btn" onclick="showPage('about')">‚ÑπÔ∏è About EA</button>
                <button class="nav-btn" onclick="showPage('customer-auth')">üë§ Customer Area</button>
                <button class="nav-btn" onclick="showPage('admin-login')">üîê Admin</button>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- HOME -->
        <div id="home" class="page active">
            <div class="hero">
                <h2>üöÄ Transform Your Trading Today</h2>
                <p>Join 500+ successful traders using our proven Expert Advisor</p>
            </div>
            
            <div class="section">
                <h2>Choose Your Perfect Plan</h2>
                
                <div class="alert alert-info" style="background: linear-gradient(135deg, rgba(0, 136, 255, 0.2), rgba(0, 102, 204, 0.1)); border: 3px solid #0088ff; margin-bottom: 30px;">
                    <h3 style="color: #00ff88; margin-bottom: 15px;">üèÜ RECOMMENDED BROKER: EXNESS</h3>
                    <p style="font-size: 1.1rem; margin-bottom: 15px;"><strong>Before purchasing, open a trading account with Exness - our recommended broker that works perfectly with Wolf FX EA!</strong></p>
                    <div style="background: rgba(10, 14, 39, 0.5); padding: 20px; border-radius: 10px; margin: 15px 0;">
                        <p style="margin-bottom: 10px;"><strong>Why Exness?</strong></p>
                        <ul style="margin-left: 20px; margin-bottom: 15px;">
                            <li>‚úÖ Fully compatible with Wolf FX EA</li>
                            <li>‚úÖ Low spreads & fast execution</li>
                            <li>‚úÖ Reliable & regulated broker</li>
                            <li>‚úÖ Multiple account types</li>
                            <li>‚úÖ Excellent customer support</li>
                        </ul>
                        <p style="color: #ffa500; margin-bottom: 15px;"><strong>‚ö†Ô∏è Important:</strong> Your license will be bound to your Exness account, broker, and server for anti-piracy protection.</p>
                    </div>
                    <button class="btn" onclick="window.open('https://one.exnesstrack.net/a/ljlgrokcle', '_blank')" style="margin-top: 15px;">
                        üöÄ Open Exness Account Now
                    </button>
                    <p style="margin-top: 15px; font-size: 0.9rem; color: #8892a8;">After opening your Exness account, return here to purchase your license!</p>
                </div>
                
                <div class="alert alert-info">
                    <strong>üìù Note:</strong> You must <span class="text-link" onclick="showPage('customer-auth')">create an account</span> before purchasing.
                </div>
                <div class="pricing-grid">
                    <div class="pricing-card">
                        <div class="plan-name">Weekly</div>
                        <div class="plan-price">$50</div>
                        <p>7 Days Access</p>
                        <button class="btn" onclick="checkLoginAndPurchase('weekly', 50, 7)">Start Weekly</button>
                    </div>
                    <div class="pricing-card">
                        <div class="plan-name">Monthly</div>
                        <div class="plan-price">$150</div>
                        <p>30 Days Access</p>
                        <button class="btn" onclick="checkLoginAndPurchase('monthly', 150, 30)">Start Monthly</button>
                    </div>
                    <div class="pricing-card">
                        <div class="plan-name">Quarterly</div>
                        <div class="plan-price">$350</div>
                        <p>90 Days ‚Ä¢ Save $100</p>
                        <button class="btn" onclick="checkLoginAndPurchase('quarterly', 350, 90)">Start Quarterly</button>
                    </div>
                    <div class="pricing-card">
                        <div class="plan-name">Annual</div>
                        <div class="plan-price">$1,499</div>
                        <p>365 Days ‚Ä¢ Save $301</p>
                        <button class="btn" onclick="checkLoginAndPurchase('annual', 1499, 365)">Start Annual</button>
                    </div>
                    <div class="pricing-card">
                        <div class="plan-name">Lifetime</div>
                        <div class="plan-price">$3,000</div>
                        <p>Forever Access</p>
                        <button class="btn" onclick="checkLoginAndPurchase('lifetime', 3000, 36500)">Get Lifetime</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ABOUT -->
        <div id="about" class="page">
            <div class="section">
                <h2>ü§ñ About Wolf FX EA</h2>
                <p>The Wolf FX Expert Advisor is specifically designed for automated Forex trading with advanced algorithms.</p>
                <h3>üîê License Protection</h3>
                <p><strong>Your EA is bound to YOUR MT5 account, broker, AND server.</strong></p>
                <ul>
                    <li>‚úÖ Works only on your specified broker and server</li>
                    <li>‚úÖ Prevents unauthorized copying and sharing</li>
                    <li>‚úÖ Maximum anti-piracy protection</li>
                </ul>
            </div>
        </div>

        <!-- CUSTOMER AUTH -->
        <div id="customer-auth" class="page">
            <div class="section">
                <h2>Customer Area</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                    <div style="border: 2px solid #00ff88; padding: 30px; border-radius: 15px;">
                        <h3>Login</h3>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="cust-login-email">
                        </div>
                        <div class="form-group">
                            <label>Password</label>
                            <input type="password" id="cust-login-pass">
                        </div>
                        <button class="btn" onclick="customerLogin()">Login</button>
                    </div>
                    <div style="border: 2px solid #00ff88; padding: 30px; border-radius: 15px;">
                        <h3>Create Account</h3>
                        <div class="form-group">
                            <label>Name</label>
                            <input type="text" id="cust-signup-name">
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="cust-signup-email">
                        </div>
                        <div class="form-group">
                            <label>Password</label>
                            <input type="password" id="cust-signup-pass">
                        </div>
                        <div class="form-group">
                            <label>Confirm Password</label>
                            <input type="password" id="cust-signup-confirm">
                        </div>
                        <button class="btn" onclick="customerSignup()">Create Account</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- CUSTOMER DASHBOARD -->
        <div id="customer-dashboard" class="page">
            <div class="section">
                <h2>Welcome, <span id="customer-name-display"></span>!</h2>
                <div id="customer-licenses-container"></div>
                <button class="btn btn-danger" onclick="customerLogout()">Logout</button>
            </div>
        </div>

        <!-- ADMIN LOGIN -->
        <div id="admin-login" class="page">
            <div class="section">
                <h2>Admin Login</h2>
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" id="admin-user" value="aminfx">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="admin-pass">
                </div>
                <button class="btn" onclick="adminLogin()">Login as Admin</button>
            </div>
        </div>

        <!-- ADMIN DASHBOARD -->
        <div id="admin-dashboard" class="page">
            <div class="section">
                <h2>Admin Dashboard</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div style="background: #1a1e37; padding: 25px; border-radius: 15px; border: 2px solid #00ff88; text-align: center;">
                        <div style="font-size: 3rem; font-weight: bold; color: #00ff88;" id="stat-customers">0</div>
                        <div style="color: #8892a8;">Customers</div>
                    </div>
                    <div style="background: #1a1e37; padding: 25px; border-radius: 15px; border: 2px solid #00ff88; text-align: center;">
                        <div style="font-size: 3rem; font-weight: bold; color: #00ff88;" id="stat-total">0</div>
                        <div style="color: #8892a8;">Total Licenses</div>
                    </div>
                    <div style="background: #1a1e37; padding: 25px; border-radius: 15px; border: 2px solid #00ff88; text-align: center;">
                        <div style="font-size: 3rem; font-weight: bold; color: #ffa500;" id="stat-pending">0</div>
                        <div style="color: #8892a8;">Pending</div>
                    </div>
                    <div style="background: #1a1e37; padding: 25px; border-radius: 15px; border: 2px solid #00ff88; text-align: center;">
                        <div style="font-size: 3rem; font-weight: bold; color: #00ff88;" id="stat-active">0</div>
                        <div style="color: #8892a8;">Active</div>
                    </div>
                    <div style="background: #1a1e37; padding: 25px; border-radius: 15px; border: 2px solid #00ff88; text-align: center;">
                        <div style="font-size: 2rem; font-weight: bold; color: #00ff88;" id="stat-revenue">$0</div>
                        <div style="color: #8892a8;">Revenue</div>
                    </div>
                </div>
                
                <div style="margin: 30px 0;">
                    <button class="btn btn-secondary btn-small" onclick="showAdminTab('licenses')">Licenses</button>
                    <button class="btn btn-secondary btn-small" onclick="showAdminTab('customers')">Customers</button>
                </div>
                
                <div id="admin-tab-licenses">
                    <h3>License Management</h3>
                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>License Key</th>
                                    <th>Customer</th>
                                    <th>Plan</th>
                                    <th>Broker/Server</th>
                                    <th>Status</th>
                                    <th>Expiry</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="admin-licenses-body"></tbody>
                        </table>
                    </div>
                </div>
                
                <div id="admin-tab-customers" class="hidden">
                    <h3>Customer Management</h3>
                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Registered</th>
                                    <th>Licenses</th>
                                    <th>Total Spent</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="admin-customers-body"></tbody>
                        </table>
                    </div>
                </div>
                
                <button class="btn btn-danger" onclick="adminLogout()" style="margin-top: 30px;">Logout</button>
            </div>
        </div>
    </div>

    <!-- PURCHASE MODAL -->
    <div id="purchaseModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal()">√ó</button>
            <div class="section">
                <h2>Purchase License</h2>
                <p style="margin-bottom: 25px;">Plan: <span id="selected-plan-name" style="color: #00ff88; font-size: 1.5rem;"></span></p>
                
                <div class="alert alert-info" style="background: linear-gradient(135deg, rgba(0, 136, 255, 0.2), rgba(0, 102, 204, 0.1)); border: 3px solid #0088ff;">
                    <h4 style="color: #00ff88; margin-bottom: 10px;">üèÜ Using Exness Broker?</h4>
                    <p style="margin-bottom: 10px;">Wolf FX EA works perfectly with Exness! If you don't have an Exness account yet:</p>
                    <button class="btn btn-secondary btn-small" onclick="window.open('https://one.exnesstrack.net/a/ljlgrokcle', '_blank')" style="margin: 10px 0;">
                        Open Exness Account
                    </button>
                    <p style="font-size: 0.9rem; color: #8892a8; margin-top: 10px;">You can use other brokers too, but Exness is highly recommended for best performance.</p>
                </div>
                
                <div class="alert alert-info">
                    <strong>‚ö†Ô∏è Anti-Piracy Protection:</strong> License will be bound to your broker and server.
                </div>
                
                <div class="form-group">
                    <label>MT5 Account *</label>
                    <input type="text" id="p-mt5" placeholder="12345678">
                </div>
                <div class="form-group">
                    <label>Broker *</label>
                    <input type="text" id="p-broker" placeholder="IC Markets">
                </div>
                <div class="form-group">
                    <label>Server *</label>
                    <input type="text" id="p-server" placeholder="ICMarkets-Demo01">
                </div>
                <div class="form-group">
                    <label>Country *</label>
                    <input type="text" id="p-country" placeholder="Ghana">
                </div>
                <div class="form-group">
                    <label>WhatsApp *</label>
                    <input type="text" id="p-whatsapp" placeholder="+233501234567">
                </div>
                
                <h3>Payment Method</h3>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 20px 0;">
                    <button class="btn btn-secondary btn-small" onclick="selectPayment('usdt')">üí∞ USDT</button>
                    <button class="btn btn-secondary btn-small" onclick="selectPayment('btc')">‚Çø Bitcoin</button>
                    <button class="btn btn-secondary btn-small" onclick="selectPayment('eth')">Œû Ethereum</button>
                    <button class="btn btn-secondary btn-small" onclick="selectPayment('bnb')">üî∂ BNB</button>
                    <button class="btn btn-secondary btn-small" onclick="selectPayment('mtn')">üì± MTN MoMo</button>
                    <button class="btn btn-secondary btn-small" onclick="selectPayment('vodafone')">üì≤ Vodafone</button>
                </div>
                
                <div id="wallet-display-box" class="hidden">
                    <div class="form-group">
                        <label>Payment Address</label>
                        <input type="text" id="wallet-address-display" readonly style="color: #00ff88;">
                    </div>
                    <div class="form-group">
                        <label>Transaction ID *</label>
                        <input type="text" id="p-txid" placeholder="Enter TX ID after payment">
                    </div>
                    <button class="btn" onclick="submitPurchase()">Submit Purchase</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script>
        emailjs.init("YOUR_PUBLIC_KEY");
        
        let DB = {
            licenses: JSON.parse(localStorage.getItem('wolffx_licenses') || '[]'),
            customers: JSON.parse(localStorage.getItem('wolffx_customers') || '[]')
        };
        
        function saveDB() {
            localStorage.setItem('wolffx_licenses', JSON.stringify(DB.licenses));
            localStorage.setItem('wolffx_customers', JSON.stringify(DB.customers));
        }
        
        let currentCustomer = null;
        let isAdmin = false;
        let currentPurchase = {};
        const wallets = {
            usdt: 'TAXifU2Q3FFiMCjzm2HRPN1HaLRGBvuYNw',
            btc: '1hW3CPAYd7NmwipzYxavY6cySuP8GAaRX',
            eth: '0xdca1049f2f663ce39dead162b2e0aeac9a00d73f',
            bnb: '0xdca1049f2f663ce39dead162b2e0aeac9a00d73f',
            mtn: '0597643120 (MTN MoMo - Amin MLM Trading Ent)',
            vodafone: '0505027255 (Vodafone Cash - Amin MLM Trading Ent)'
        };
        
        function showPage(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(page).classList.add('active');
        }
        
        function customerSignup() {
            const name = document.getElementById('cust-signup-name').value.trim();
            const email = document.getElementById('cust-signup-email').value.trim();
            const password = document.getElementById('cust-signup-pass').value.trim();
            const confirm = document.getElementById('cust-signup-confirm').value.trim();
            
            if (!name || !email || !password) return alert('Fill all fields!');
            if (password !== confirm) return alert('Passwords don\'t match!');
            if (DB.customers.find(c => c.email === email)) return alert('Email already registered!');
            
            DB.customers.push({email, password, name, created: new Date().toISOString()});
            saveDB();
            
            // Auto-login after signup
            currentCustomer = {email, password, name, created: new Date().toISOString()};
            
            // Send welcome email with Exness recommendation
            sendWelcomeEmail(name, email);
            
            alert('‚úÖ Account created successfully!\n\nYou are now logged in. Please select a pricing plan to continue.\n\nüìß Check your email for important setup information!');
            
            // Clear form
            document.getElementById('cust-signup-name').value = '';
            document.getElementById('cust-signup-email').value = '';
            document.getElementById('cust-signup-pass').value = '';
            document.getElementById('cust-signup-confirm').value = '';
            
            // Redirect to homepage to select plan
            showPage('home');
        }
        
        function sendWelcomeEmail(name, email) {
            emailjs.send('YOUR_SERVICE_ID', 'YOUR_WELCOME_TEMPLATE_ID', {
                to_email: email,
                customer_name: name,
                exness_link: 'https://one.exnesstrack.net/a/ljlgrokcle',
                login_url: window.location.origin,
                support_email: 'aminfx.gh@gmail.com',
                whatsapp_link: 'https://chat.whatsapp.com/GN3XhxcknMcA9PjOIBumPS'
            }).then(() => {
                console.log('Welcome email sent to:', email);
            }).catch(err => {
                console.error('Welcome email failed:', err);
            });
        }
        
        function customerLogin() {
            const email = document.getElementById('cust-login-email').value.trim();
            const pass = document.getElementById('cust-login-pass').value.trim();
            const customer = DB.customers.find(c => c.email === email && c.password === pass);
            
            if (!customer) return alert('Invalid credentials!');
            currentCustomer = customer;
            showPage('customer-dashboard');
            loadCustomerDashboard();
        }
        
        function customerLogout() {
            currentCustomer = null;
            showPage('customer-auth');
        }
        
        function loadCustomerDashboard() {
            document.getElementById('customer-name-display').textContent = currentCustomer.name;
            const licenses = DB.licenses.filter(l => l.email === currentCustomer.email);
            let html = '<h3>My Licenses</h3>';
            
            if (licenses.length === 0) {
                html += '<div class="alert alert-info">No licenses yet. <a href="#" onclick="showPage(\'home\')" class="text-link">Purchase a plan now</a></div>';
            } else {
                html += '<div style="overflow-x: auto;"><table><tr><th>License Key</th><th>Plan</th><th>Broker/Server</th><th>Status</th><th>Expiry</th><th>Time Left</th></tr>';
                licenses.forEach(lic => {
                    const badge = lic.status === 'active' ? 'badge-active' : lic.status === 'expired' ? 'badge-expired' : 'badge-pending';
                    const licenseDisplay = lic.licenseKey || '<em style="color: #ffa500;">Awaiting Approval</em>';
                    const brokerServer = `${lic.broker}/${lic.server}`;
                    const timeLeft = lic.activationTime && lic.status === 'active' ? calculateTime(lic.activationTime, lic.durationDays) : 'N/A';
                    
                    html += `<tr>
                        <td style="font-family: monospace;">${licenseDisplay}</td>
                        <td><strong>${lic.plan.toUpperCase()}</strong> ($${lic.price})</td>
                        <td style="font-size: 0.9rem;">${brokerServer}</td>
                        <td><span class="badge ${badge}">${lic.status.toUpperCase()}</span></td>
                        <td>${lic.expiry || 'Pending'}</td>
                        <td>${timeLeft}</td>
                    </tr>`;
                });
                html += '</table></div>';
                
                if (licenses.some(l => l.status === 'pending')) {
                    html += '<div class="alert alert-info" style="margin-top: 20px;"><strong>‚è≥ Pending License:</strong> Your license key will be generated and sent to your email once the admin verifies your payment.</div>';
                }
            }
            
            document.getElementById('customer-licenses-container').innerHTML = html;
        }
        
        function checkLoginAndPurchase(plan, price, days) {
            if (!currentCustomer) {
                alert('Please create an account and login first!');
                return showPage('customer-auth');
            }
            startPurchase(plan, price, days);
        }
        
        function startPurchase(plan, price, days) {
            currentPurchase = {plan, price, days};
            document.getElementById('selected-plan-name').textContent = plan.toUpperCase() + ' - $' + price;
            document.getElementById('purchaseModal').classList.add('active');
        }
        
        function closeModal() {
            document.getElementById('purchaseModal').classList.remove('active');
        }
        
        function selectPayment(method) {
            document.getElementById('wallet-address-display').value = wallets[method];
            document.getElementById('wallet-display-box').classList.remove('hidden');
            currentPurchase.method = method;
        }
        
        function submitPurchase() {
            const mt5 = document.getElementById('p-mt5').value.trim();
            const broker = document.getElementById('p-broker').value.trim();
            const server = document.getElementById('p-server').value.trim();
            const txid = document.getElementById('p-txid').value.trim();
            
            if (!mt5 || !broker || !server || !txid) return alert('Fill all fields!');
            if (!currentPurchase.method) return alert('Please select a payment method!');
            
            // Don't generate license key yet - admin will generate on approval
            const newLicense = {
                licenseKey: null, // Will be generated by admin on approval
                status: 'pending',
                plan: currentPurchase.plan,
                price: currentPurchase.price,
                durationDays: currentPurchase.days,
                name: currentCustomer.name,
                email: currentCustomer.email,
                mt5, broker, server,
                country: document.getElementById('p-country').value.trim(),
                whatsapp: document.getElementById('p-whatsapp').value.trim(),
                method: currentPurchase.method,
                txid,
                created: new Date().toISOString(),
                activationTime: null,
                expiry: null
            };
            
            DB.licenses.push(newLicense);
            saveDB();
            
            // Send admin notification
            sendAdminNotification(newLicense);
            
            alert('‚úÖ Purchase submitted successfully!\n\nYour payment is being verified.\n\nYou will receive your license key via email once the admin approves your transaction.');
            closeModal();
            
            // Refresh customer dashboard if they're logged in
            if (currentCustomer) {
                showPage('customer-dashboard');
                loadCustomerDashboard();
            }
        }
        
        function sendAdminNotification(license) {
            emailjs.send('YOUR_SERVICE_ID', 'YOUR_ADMIN_TEMPLATE_ID', {
                to_email: 'aminfx.gh@gmail.com',
                customer_name: license.name,
                customer_email: license.email,
                plan: license.plan.toUpperCase(),
                price: license.price,
                mt5: license.mt5,
                broker: license.broker,
                server: license.server,
                country: license.country,
                whatsapp: license.whatsapp,
                method: license.method.toUpperCase(),
                txid: license.txid
            }).then(() => console.log('Admin notified'))
            .catch(err => console.error('Email error:', err));
        }
        
        function adminLogin() {
            const user = document.getElementById('admin-user').value.trim();
            const pass = document.getElementById('admin-pass').value.trim();
            
            if (user === 'aminfx' && pass === 'Amiena702$') {
                isAdmin = true;
                showPage('admin-dashboard');
                loadAdminDashboard();
            } else {
                alert('Invalid credentials!');
            }
        }
        
        function adminLogout() {
            isAdmin = false;
            showPage('admin-login');
        }
        
        function loadAdminDashboard() {
            document.getElementById('stat-customers').textContent = DB.customers.length;
            document.getElementById('stat-total').textContent = DB.licenses.length;
            document.getElementById('stat-pending').textContent = DB.licenses.filter(l => l.status === 'pending').length;
            document.getElementById('stat-active').textContent = DB.licenses.filter(l => l.status === 'active').length;
            document.getElementById('stat-revenue').textContent = '$' + DB.licenses.filter(l => l.status === 'active').reduce((s, l) => s + l.price, 0);
            
            displayAllLicenses();
            displayAllCustomers();
        }
        
        function showAdminTab(tab) {
            if (tab === 'licenses') {
                document.getElementById('admin-tab-licenses').classList.remove('hidden');
                document.getElementById('admin-tab-customers').classList.add('hidden');
            } else {
                document.getElementById('admin-tab-licenses').classList.add('hidden');
                document.getElementById('admin-tab-customers').classList.remove('hidden');
            }
        }
        
        function displayAllLicenses() {
            let html = '';
            DB.licenses.forEach((lic, idx) => {
                const badge = lic.status === 'active' ? 'badge-active' : lic.status === 'expired' ? 'badge-expired' : 'badge-pending';
                const timeLeft = lic.activationTime && lic.status === 'active' ? calculateTime(lic.activationTime, lic.durationDays) : 'N/A';
                const licenseDisplay = lic.licenseKey || '<em style="color: #ffa500;">Will be generated on approval</em>';
                
                html += `<tr>
                    <td style="font-family: monospace; font-size: 0.9rem;">${licenseDisplay}</td>
                    <td>${lic.name}</td>
                    <td><strong>${lic.plan.toUpperCase()}</strong> ($${lic.price})</td>
                    <td style="font-size: 0.85rem;">${lic.broker}/${lic.server}</td>
                    <td><span class="badge ${badge}">${lic.status.toUpperCase()}</span></td>
                    <td>${timeLeft}</td>
                    <td style="white-space: nowrap;">
                        ${lic.status === 'pending' ? `
                            <button class="btn btn-small" onclick="approveLicense(${idx})">‚úÖ Approve & Generate Key</button>
                            <button class="btn btn-small btn-danger" onclick="deleteLicense(${idx})">üóëÔ∏è Delete</button>
                        ` : ''}
                        ${lic.status === 'active' ? `
                            <button class="btn btn-small btn-danger" onclick="suspendLicense(${idx})">üõë Suspend</button>
                            <button class="btn btn-small btn-danger" onclick="deleteLicense(${idx})">üóëÔ∏è Delete</button>
                        ` : ''}
                    </td>
                </tr>`;
            });
            document.getElementById('admin-licenses-body').innerHTML = html || '<tr><td colspan="7">No licenses</td></tr>';
        }
        
        function displayAllCustomers() {
            let html = '';
            DB.customers.forEach((cust, idx) => {
                const licenses = DB.licenses.filter(l => l.email === cust.email);
                const spent = licenses.filter(l => l.status === 'active').reduce((s, l) => s + l.price, 0);
                
                html += `<tr>
                    <td>${cust.name}</td>
                    <td>${cust.email}</td>
                    <td>${new Date(cust.created).toLocaleDateString()}</td>
                    <td>${licenses.length}</td>
                    <td>$${spent}</td>
                    <td><button class="btn btn-small btn-danger" onclick="deleteCustomer(${idx})">Delete</button></td>
                </tr>`;
            });
            document.getElementById('admin-customers-body').innerHTML = html || '<tr><td colspan="6">No customers</td></tr>';
        }
        
        function calculateTime(activationTime, days) {
            const activated = new Date(activationTime);
            const expiry = new Date(activated.getTime() + (days * 24 * 60 * 60 * 1000));
            const now = new Date();
            const diff = expiry - now;
            
            if (diff <= 0) return 'EXPIRED';
            
            const d = Math.floor(diff / (1000 * 60 * 60 * 24));
            const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            return `${d}d ${h}h`;
        }
        
        function approveLicense(idx) {
            const lic = DB.licenses[idx];
            if (!confirm(`‚úÖ APPROVE LICENSE?\n\nVerify payment first!\n\nCustomer: ${lic.name}\nPlan: ${lic.plan.toUpperCase()}\nAmount: $${lic.price}\nPayment: ${lic.method.toUpperCase()}\nTX ID: ${lic.txid}\n\nHave you verified this transaction ID in your wallet?`)) return;
            
            // Generate license key NOW (after admin verification)
            const licenseKey = 'WOLF-' + generateRandomString(4) + '-' + generateRandomString(4) + '-' + generateRandomString(4) + '-' + generateRandomString(4);
            
            lic.licenseKey = licenseKey;
            lic.status = 'active';
            lic.activationTime = new Date().toISOString();
            const expiry = new Date();
            expiry.setDate(expiry.getDate() + lic.durationDays);
            lic.expiry = expiry.toISOString().split('T')[0];
            
            saveDB();
            
            // Send email with VPS info
            const vpsLink = 'https://my.hyonix.com/aff.php?aff=3926';
            emailjs.send('YOUR_SERVICE_ID', 'YOUR_ACTIVATION_TEMPLATE_ID', {
                to_email: lic.email,
                customer_name: lic.name,
                license_key: licenseKey,
                plan: lic.plan.toUpperCase(),
                expiry_date: lic.expiry,
                broker: lic.broker,
                server: lic.server,
                mt5_account: lic.mt5,
                vps_link: vpsLink,
                vps_price: '$6',
                vps_message: 'For uninterrupted 24/7 trading, we recommend using a VPS. Get started for as low as $6/month with our recommended provider.',
                download_link: 'https://yoursite.com/download',
                whatsapp_link: 'https://chat.whatsapp.com/GN3XhxcknMcA9PjOIBumPS'
            }).then(() => {
                alert(`‚úÖ LICENSE APPROVED!\n\nLicense Key Generated: ${licenseKey}\n\nActivation email sent to customer with:\n- License key\n- Broker/Server binding info\n- VPS recommendation\n- Download link`);
                loadAdminDashboard();
            }).catch(err => {
                alert(`‚úÖ LICENSE APPROVED!\n\nLicense Key: ${licenseKey}\n\n‚ö†Ô∏è Email failed to send.\nPlease manually notify customer:\n${lic.email}\n\nLicense: ${licenseKey}`);
                console.error('Email error:', err);
                loadAdminDashboard();
            });
        }
        
        function generateRandomString(length) {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < length; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }
        
        function suspendLicense(idx) {
            if (confirm('Suspend this license?')) {
                DB.licenses[idx].status = 'expired';
                saveDB();
                loadAdminDashboard();
            }
        }
        
        function deleteLicense(idx) {
            if (confirm('DELETE this license?')) {
                DB.licenses.splice(idx, 1);
                saveDB();
                loadAdminDashboard();
            }
        }
        
        function deleteCustomer(idx) {
            const cust = DB.customers[idx];
            const licenses = DB.licenses.filter(l => l.email === cust.email);
            
            if (licenses.length > 0 && !confirm(`This customer has ${licenses.length} licenses. Delete all?`)) return;
            
            DB.licenses = DB.licenses.filter(l => l.email !== cust.email);
            DB.customers.splice(idx, 1);
            saveDB();
            loadAdminDashboard();
        }
    </script>
</body>
</html>
